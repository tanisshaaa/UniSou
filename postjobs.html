<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post a Job</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styling for the dropdown arrows */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
        }
        .chip {
            background-color: #2D9E8F; /* A shade of teal/green */
            color: white;
            border-radius: 9999px; /* Rounded corners */
            padding: 0.5rem 1rem;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .chip:hover {
            background-color: #257D71;
        }
        .chip-remove {
            margin-left: 0.5rem;
            font-weight: bold;
            font-size: 0.875rem;
        }
        .chip-remove:hover {
            opacity: 0.7;
        }
        .industry-dropdown-container {
            position: relative;
        }
        .industry-input-area {
            min-height: 48px;
            padding: 0.75rem 1rem;
            border: 2px solid #D1D5DB; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem; /* gap-2 */
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .industry-input-area:focus-within,
        .industry-input-area.active {
            border-color: #3B82F6; /* blue-500 */
            outline: none;
        }
        .industry-dropdown {
            position: absolute;
            z-index: 10;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #E5E7EB;
            top: 100%;
            margin-top: 0.5rem;
            display: none;
        }
        .industry-dropdown.show {
            display: block;
        }
        .industry-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .industry-item:hover {
            background-color: #F3F4F6;
        }
        .industry-item input[type="checkbox"] {
            margin-right: 0.75rem;
        }

        /* Custom Modal Styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 400px;
            width: 90%;
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
        .modal-content.success {
            border-top: 4px solid #10B981; /* Green */
        }
        .modal-content.error {
            border-top: 4px solid #EF4444; /* Red */
        }
        .modal-content.info {
            border-top: 4px solid #3B82F6; /* Blue */
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3B82F6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="container max-w-4xl bg-white p-8 rounded-xl shadow-lg border border-gray-200">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">Post a Job</h2>
        <form id="jobForm" class="space-y-6">

            <!-- Job Title -->
            <div>
                <label for="jobTitle" class="block text-gray-700 font-semibold mb-2">Job Title<span class="text-red-500">*</span></label>
                <input type="text" name="jobTitle" id="jobTitle" required
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
            </div>

            <!-- Targeting Industry with multiple select (checkbox dropdown) -->
            <div class="industry-dropdown-container">
                <label for="industryInputArea" class="block text-gray-700 font-semibold mb-2">Industry (Select up to 5)<span class="text-red-500">*</span></label>
                <div id="industryInputArea" class="industry-input-area" tabindex="0">
                    <!-- Selected industry chips will be rendered here -->
                    <span id="industryPlaceholder" class="text-gray-400">Select industries...</span>
                </div>
                <div id="industryDropdown" class="industry-dropdown">
                    <!-- Industry list with checkboxes will be rendered here -->
                </div>
                <p id="industryError" class="text-red-500 text-sm mt-1 hidden">Please select at least one industry.</p>
            </div>

            <!-- Hidden input to store selected industries for form submission -->
            <input type="hidden" name="targetingIndustry" id="targetingIndustryHidden" required>

            <!-- Category -->
            <div>
                <label for="category" class="block text-gray-700 font-semibold mb-2">Category<span class="text-red-500">*</span></label>
                <select id="category" name="category" required
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <option value="">-- Select Category --</option>
                    <option value="Finance">Finance</option>
                    <option value="Sales & Marketing">Sales & Marketing</option>
                    <option value="Consulting">Consulting</option>
                    <option value="HR">HR</option>
                    <option value="IT & Systems">IT & Systems</option>
                    <option value="Operations">Operations</option>
                    <option value="Legal">Legal</option>
                    <option value="BPO">BPO</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Research">Research</option>
                    <option value="Customer Support">Customer Support</option>
                    <option value="Supply Chain">Supply Chain</option>
                    <option value="Project Management">Project Management</option>
                </select>
            </div>

            <!-- Functional Area -->
            <div>
                <label for="functionalArea" class="block text-gray-700 font-semibold mb-2">Functional Area<span class="text-red-500">*</span></label>
                <select id="functionalArea" name="functionalArea" required
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <option value="">-- Select Functional Area --</option>
                    <option value="Accounting / Taxation / Audit">Accounting / Taxation / Audit</option>
                    <option value="Administration">Administration</option>
                    <option value="Analytics & Business Intelligence">Analytics & Business Intelligence</option>
                    <option value="Banking / Financial Services">Banking / Financial Services</option>
                    <option value="Content Writer / Editors">Content Writer / Editors</option>
                    <option value="Corporate Planning / Consulting / Strategy">Corporate Planning / Consulting / Strategy</option>
                    <option value="Design">Design</option>
                    <option value="Education / Language Specialist">Education / Language Specialist</option>
                    <option value="Entrepreneur / Businessman / Outside Management Consultant">Entrepreneur / Businessman / Outside Management Consultant</option>
                    <option value="Executive Assistant / Personal Secretary">Executive Assistant / Personal Secretary</option>
                    <option value="Export / Import / Merchandising">Export / Import / Merchandising</option>
                    <option value="Hotels / Restaurant Management">Hotels / Restaurant Management</option>
                    <option value="HR / IR">HR / IR</option>
                    <option value="Instructional Designer">Instructional Designer</option>
                    <option value="Insurance">Insurance</option>
                    <option value="IT">IT</option>
                    <option value="ITeS / BPO / Customer Service">ITeS / BPO / Customer Service</option>
                    <option value="KPO / Research">KPO / Research</option>
                    <option value="Legal / Law / Company Secretary">Legal / Law / Company Secretary</option>
                    <option value="Marketing / Advertising / Public Relations">Marketing / Advertising / Public Relations</option>
                    <option value="Media / Entertainment">Media / Entertainment</option>
                    <option value="Pharma / Biotech / Healthcare / Medical / R&D">Pharma / Biotech / Healthcare / Medical / R&D</option>
                    <option value="Production / Maintenance / Quality Assurance">Production / Maintenance / Quality Assurance</option>
                    <option value="Purchase / Supply Chain / Logistics">Purchase / Supply Chain / Logistics</option>
                    <option value="Research & Development">Research & Development</option>
                    <option value="Sales / Business Development / Client Servicing">Sales / Business Development / Client Servicing</option>
                    <option value="Top Management">Top Management</option>
                    <option value="Training & Development">Training & Development</option>
                    <option value="Travel / Hospitality">Travel / Hospitality</option>
                    <option value="Visual Merchandising">Visual Merchandising</option>
                    <option value="Presales / RFP">Presales / RFP</option>
                    <option value="Real Estate / Construction">Real Estate / Construction</option>
                    <option value="NGO / Social Services / CSR">NGO / Social Services / CSR</option>
                    <option value="Miscellaneous">Miscellaneous</option>
                    <option value="Product Management">Product Management</option>
                    <option value="Other">Other</option>
                    <option value="Art & Design">Art & Design</option>
                    <option value="Retail">Retail</option>
                    <option value="E-commerce">E-commerce</option>
                    <option value="Hospitality">Hospitality</option>
                    <option value="Manufacturing">Manufacturing</option>
                </select>
            </div>

            <div>
    <label for="employmentType" class="block text-gray-700 font-semibold mb-2">
        Employment Type<span class="text-red-500">*</span>
    </label>
    <select id="employmentType" name="employmentType" required
        class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
        <option value="">-- Select Employment Type --</option>
        <option value="Full Time">Full Time</option>
        <option value="Part Time">Part Time</option>
        <option value="Internship">Internship</option>
        <option value="Contract">Contract</option>
        <option value="Freelance">Freelance</option>
    </select>
</div>

            <!-- Experience (Min/Max Years) -->
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Experience (in years)<span class="text-red-500">*</span></label>
                <div class="flex gap-4">
                    <input type="number" name="minExperience" id="minExperience" placeholder="Min Exp" min="0" required
                        class="w-1/2 px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <input type="number" name="maxExperience" id="maxExperience" placeholder="Max Exp" min="0" required
                        class="w-1/2 px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                </div>
                <p id="experienceError" class="text-red-500 text-sm mt-1 hidden">Max Experience must be greater than or equal to Min Experience.</p>
            </div>

            <!-- Salary Range (Min/Max CTC) -->
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Salary (CTC in ₹)<span class="text-red-500">*</span></label>
                <div class="flex gap-4">
                    <input type="number" name="minCTC" id="minCTC" placeholder="Min CTC" min="0" required
                        class="w-1/2 px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <input type="number" name="maxCTC" id="maxCTC" placeholder="Max CTC" min="0" required
                        class="w-1/2 px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                </div>
                <p id="ctcError" class="text-red-500 text-sm mt-1 hidden">Max CTC must be greater than or equal to Min CTC.</p>
            </div>

            <!-- Job Location -->
            <div>
                <label for="location" class="block text-gray-700 font-semibold mb-2">Job Location<span class="text-red-500">*</span></label>
                <select id="location" name="location" required
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <option value="">-- Select Location --</option>
                    <option value="Mumbai">Mumbai</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Bangalore">Bangalore</option>
                    <option value="Hyderabad">Hyderabad</option>
                    <option value="Chennai">Chennai</option>
                    <option value="Pune">Pune</option>
                    <option value="Kolkata">Kolkata</option>
                    <option value="Ahmedabad">Ahmedabad</option>
                    <option value="Jaipur">Jaipur</option>
                    <option value="Lucknow">Lucknow</option>
                    <option value="Remote">Remote</option>
                </select>
            </div>

            <!-- Candidate Profile (renamed from Targeting) -->
            <div>
                <label for="candidateProfile" class="block text-gray-700 font-semibold mb-2">Candidate Profile<span class="text-red-500">*</span></label>
                <select name="candidateProfile" id="candidateProfile" required
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <option value="">-- Select --</option>
                    <option value="Freshers">Freshers</option>
                    <option value="Experienced">Experienced</option>
                    <option value="Tech Background">Tech Background</option>
                    <option value="MBA">MBA</option>
                    <option value="Interns">Interns</option>
                    <option value="Remote Workers">Remote Workers</option>
                </select>
            </div>

            <!-- Graduating Year (Min/Max Year) -->
            <div>
                <label class="block text-gray-700 font-semibold mb-2">Graduating Year<span class="text-red-500">*</span></label>
                <div class="flex gap-4">
                    <input type="number" name="minGradYear" id="minGradYear" placeholder="Min Year" required
                        class="w-1/2 px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <input type="number" name="maxGradYear" id="maxGradYear" placeholder="Max Year" required
                        class="w-1/2 px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                </div>
                <p id="gradYearError" class="text-red-500 text-sm mt-1 hidden">Max Year must be greater than or equal to Min Year.</p>
            </div>

            <!-- Course Type -->
            <div>
                <label for="courseType" class="block text-gray-700 font-semibold mb-2">Course Type<span class="text-red-500">*</span></label>
                <select name="courseType" id="courseType" required
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <option value="B.Tech">B.Tech</option>
                    <option value="M.Tech">M.Tech</option>
                    <option value="B.Sc">B.Sc</option>
                    <option value="MBA">MBA</option>
                </select>
            </div>

            <!-- Preferred Candidates -->
            <!-- Preferred Candidates -->
            <div>
                <label for="preferred" class="block text-gray-700 font-semibold mb-2">Preferred Candidates</label>
                <select name="preferred" id="preferred"
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300">
                    <option value="">-- Select --</option>
                    <option value="Women">Women</option>
                    <option value="PWD">PWD</option>
                    <option value="Both">Both</option>
                </select>
            </div>
            
            <!-- Job Description with AI button -->
            <div class="mt-8">
                <div class="flex justify-between items-center mb-2">
                    <label for="jobDescription" class="block text-gray-700 font-semibold">Job Description<span class="text-red-500">*</span></label>
                    <button type="button" onclick="generateJobDescription()" id="generateDescriptionBtn"
                        class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-blue-600 text-sm">
                        Create with AI
                    </button>
                </div>
                <textarea name="jobDescription" id="jobDescription" rows="10" required
                    class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 transition duration-300"></textarea>
            </div>

            <!-- Generated Job Link Display -->
            <div id="jobLinkDisplay" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
                <label class="block text-blue-800 font-semibold mb-2">Shareable Job Link:</label>
                <div class="flex items-center space-x-2">
                    <input type="text" id="generatedJobLink" readonly
                        class="flex-grow px-3 py-2 rounded-lg border border-blue-300 bg-white text-blue-700 text-sm focus:outline-none">
                    <button type="button" onclick="copyJobLink()"
                        class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-blue-700 text-sm whitespace-nowrap">
                        Copy Link
                    </button>
                </div>
            </div>

            <!-- LinkedIn Checkbox -->
            <div class="flex items-center">
                <input type="checkbox" id="postOnLinkedIn" name="postOnLinkedIn" class="form-checkbox text-blue-600 h-5 w-5 rounded-md focus:ring-blue-500 border-gray-300">
                <label for="postOnLinkedIn" class="ml-2 text-gray-700 font-medium">Post to LinkedIn</label>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row justify-between gap-4 mt-8">
                <button class="btn post bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300"
                    type="submit" onclick="submitForm(event, false)">Post</button>
                <button class="btn post-add bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300"
                    type="submit" onclick="submitForm(event, true)">Post & Add Another</button>
                <button class="btn cancel bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300"
                    type="button" onclick="window.location.href='myjobs.html'">Cancel</button>
            </div>

        </form>
    </div>

    <!-- Custom Message Modal -->
    <div id="messageModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-xl font-bold mb-4"></h3>
            <p id="modalMessage" class="text-gray-700 mb-6"></p>
            <button onclick="hideMessage()" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-blue-600">
                OK
            </button>
        </div>
    </div>

    <script>
        const industries = [
    'Banking', 'Healthcare', 'Information Technology (IT)', 'Telecommunications', 'Pharmaceuticals', 'Energy', 'Oil & Gas',
    'Aerospace', 'Defense', 'Automotive', 'Insurance', 'Investment & Asset Management', 'Fintech',
    'Accounting & Audit', 'Consulting', 'Legal Services', 'Real Estate', 'Business Process Outsourcing (BPO)',
    'Human Resources (HR)', 'Private Equity & Venture Capital', 'Mechanical Engineering',
    'Civil Engineering & Construction', 'Electrical & Electronics', 'Industrial Manufacturing', 'Textile & Apparel',
    'Shipbuilding & Maritime', 'Chemical Manufacturing', 'Robotics & Automation',
    '3D Printing & Additive Manufacturing', 'Renewable Energy (Solar/Wind)', 'Retail & E-Commerce',
    'FMCG (Fast-Moving Consumer Goods)', 'Luxury Goods', 'Consumer Electronics', 'Food & Beverage', 'Hospitality',
    'Travel & Tourism', 'Entertainment & Media', 'Fashion & Lifestyle', 'Beauty & Cosmetics',
    'Cybersecurity', 'Artificial Intelligence & Machine Learning', 'Blockchain & Cryptocurrency',
    'Biotechnology', 'EdTech (Education Technology)', 'AgriTech', 'HealthTech', 'CleanTech', 'Gaming & Esports',
    'SpaceTech'
];

let selectedIndustries = [];
const maxSelections = 5;

const industryDropdown = document.getElementById('industryDropdown');
const industryInputArea = document.getElementById('industryInputArea');
const industryPlaceholder = document.getElementById('industryPlaceholder');
const hiddenIndustryInput = document.getElementById('targetingIndustryHidden');
const industryError = document.getElementById('industryError');
const generateDescriptionBtn = document.getElementById('generateDescriptionBtn');
const jobLinkDisplay = document.getElementById('jobLinkDisplay');
const generatedJobLinkInput = document.getElementById('generatedJobLink');
const minCTCInput = document.getElementById('minCTC');
const maxCTCInput = document.getElementById('maxCTC');
const ctcError = document.getElementById('ctcError');
const minGradYearInput = document.getElementById('minGradYear');
const maxGradYearInput = document.getElementById('maxGradYear');
const gradYearError = document.getElementById('gradYearError');
const minExperienceInput = document.getElementById('minExperience');
const maxExperienceInput = document.getElementById('maxExperience');
const experienceError = document.getElementById('experienceError');
const postOnLinkedInCheckbox = document.getElementById('postOnLinkedIn');


const messageModal = document.getElementById('messageModal');
const modalTitle = document.getElementById('modalTitle');
const modalMessage = document.getElementById('modalMessage');
const modalContent = messageModal.querySelector('.modal-content');


/**
 * Displays a custom message modal.
 * @param {string} type - 'success', 'error', or 'info'.
 * @param {string} title - The title for the modal.
 * @param {string} message - The message to display.
 */
function showMessage(type, title, message) {
    modalTitle.textContent = title;
    modalMessage.textContent = message;
    modalContent.className = 'modal-content'; // Reset classes
    modalContent.classList.add(type); // Add type-specific class for styling
    messageModal.classList.add('show');
}

/**
 * Hides the custom message modal.
 */
function hideMessage() {
    messageModal.classList.remove('show');
}

/**
 * Renders the list of industries in the dropdown with checkboxes.
 */
function renderIndustriesDropdown() {
    industryDropdown.innerHTML = '';
    industries.forEach(industry => {
        const div = document.createElement('div');
        div.className = 'industry-item';
        div.innerHTML = `
            <input type="checkbox" id="industry-${industry.replace(/\s/g, '-')}" value="${industry}"
                class="form-checkbox text-blue-600 h-5 w-5 rounded-md focus:ring-blue-500 border-gray-300">
            <label for="industry-${industry.replace(/\s/g, '-')}" class="ml-2 cursor-pointer">${industry}</label>
        `;
        const checkbox = div.querySelector('input[type="checkbox"]');
        checkbox.checked = selectedIndustries.includes(industry);

        checkbox.addEventListener('change', () => {
            toggleIndustrySelection(industry, checkbox);
        });
        // Allow clicking the entire item to toggle the checkbox
        div.addEventListener('click', (e) => {
            if (e.target !== checkbox) { // Prevent double-toggling if clicking checkbox directly
                checkbox.checked = !checkbox.checked;
                toggleIndustrySelection(industry, checkbox);
            }
        });
        industryDropdown.appendChild(div);
    });
}

/**
 * Renders the selected industry chips in the input area.
 */
function renderSelectedChips() {
    industryInputArea.innerHTML = ''; // Clear existing content
    if (selectedIndustries.length === 0) {
        industryInputArea.appendChild(industryPlaceholder);
    } else {
        industryPlaceholder.remove(); // Remove placeholder if chips are present
        selectedIndustries.forEach(industry => {
            const span = document.createElement('span');
            span.className = 'chip';
            span.innerHTML = `
                <span>${industry}</span>
                <span class="chip-remove">×</span>
            `;
            span.querySelector('.chip-remove').onclick = (e) => {
                e.stopPropagation(); // Prevent dropdown from toggling
                removeIndustry(industry);
            };
            industryInputArea.appendChild(span);
        });
    }
    // Update the hidden input field with the current selections
    hiddenIndustryInput.value = JSON.stringify(selectedIndustries);

    // Show/hide industry error message based on selection
    if (selectedIndustries.length === 0) {
        industryError.classList.remove('hidden');
        industryInputArea.classList.add('border-red-500');
        industryInputArea.classList.remove('border-gray-300');
    } else {
        industryError.classList.add('hidden');
        industryInputArea.classList.remove('border-red-500');
        industryInputArea.classList.add('border-gray-300');
    }
    renderIndustriesDropdown(); // Re-render dropdown to update checkbox states
}

/**
 * Toggles an industry in the selected list based on checkbox state.
 * @param {string} industry - The industry to toggle.
 * @param {HTMLInputElement} checkbox - The checkbox element.
 */
function toggleIndustrySelection(industry, checkbox) {
    if (checkbox.checked) {
        if (selectedIndustries.length < maxSelections && !selectedIndustries.includes(industry)) {
            selectedIndustries.push(industry);
        } else if (!selectedIndustries.includes(industry)) {
            // If max selections reached and trying to add a new one
            checkbox.checked = false; // Revert checkbox state
            showMessage('info', 'Maximum Reached', `You can select a maximum of ${maxSelections} industries.`);
        }
    } else {
        selectedIndustries = selectedIndustries.filter(item => item !== industry);
    }
    renderSelectedChips(); // Update chips and hidden input
}

/**
 * Removes an industry from the selected list.
 * This is called when the 'x' on a chip is clicked.
 * @param {string} industry - The industry to remove.
 */
function removeIndustry(industry) {
    selectedIndustries = selectedIndustries.filter(item => item !== industry);
    renderSelectedChips(); // Update chips and hidden input
    // Also uncheck the corresponding checkbox in the dropdown if it's open
    const checkbox = document.getElementById(`industry-${industry.replace(/\s/g, '-')}`);
    if (checkbox) {
        checkbox.checked = false;
    }
}

/**
 * Shows the industry dropdown.
 */
function showDropdown() {
    industryDropdown.classList.add('show');
    industryInputArea.classList.add('active'); // Add active class for styling
    renderIndustriesDropdown(); // Ensure dropdown is up-to-date
}

/**
 * Hides the industry dropdown.
 */
function hideDropdown() {
    industryDropdown.classList.remove('show');
    industryInputArea.classList.remove('active'); // Remove active class
}

// Toggle dropdown visibility when clicking the input area
industryInputArea.addEventListener('click', (e) => {
    if (!industryDropdown.classList.contains('show')) {
        showDropdown();
    } else if (!industryDropdown.contains(e.target) && e.target !== industryInputArea) {
        // If clicked inside input area but not on dropdown, don't hide
        // This handles clicks on chips within the input area
    } else {
        hideDropdown();
    }
});

// Hide dropdown when clicking outside of it
window.addEventListener('click', function(e) {
    const industryContainer = document.querySelector('.industry-dropdown-container');
    if (industryContainer && !industryContainer.contains(e.target)) {
        hideDropdown();
    }
});

// Initialize the chip rendering and the dropdown list
document.addEventListener('DOMContentLoaded', () => {
    renderSelectedChips(); // Initial render of chips (or placeholder)
    renderIndustriesDropdown(); // Initial render of dropdown content

    // Set dynamic min/max for graduating year
    const currentYear = new Date().getFullYear();
    minGradYearInput.min = currentYear - 10;
    minGradYearInput.max = currentYear + 5; // Max can be up to 5 years from now
    maxGradYearInput.min = currentYear - 10;
    maxGradYearInput.max = currentYear + 5;

    // Set default values
    minGradYearInput.value = currentYear;
    maxGradYearInput.value = currentYear + 4; // Default range for future graduates

    // Set default values for experience
    minExperienceInput.value = 0;
    maxExperienceInput.value = 5;
});

/**
 * Validates all required fields in the form, including CTC, Grad Year, and Experience ranges.
 * @returns {boolean} True if all fields are valid, false otherwise.
 */
function validateForm() {
    const form = document.getElementById('jobForm');
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;
    let firstInvalidField = null;

    requiredFields.forEach(field => {
        if (field.type === 'hidden') {
            // Special handling for hidden industry input
            if (field.id === 'targetingIndustryHidden' && selectedIndustries.length === 0) {
                industryError.classList.remove('hidden');
                industryInputArea.classList.add('border-red-500');
                industryInputArea.classList.remove('border-gray-300');
                isValid = false;
                if (!firstInvalidField) firstInvalidField = industryInputArea;
            }
            return;
        }

        if (!field.value.trim()) {
            isValid = false;
            field.classList.add('border-red-500');
            field.classList.remove('border-gray-300');
            if (!firstInvalidField) firstInvalidField = field;
        } else {
            field.classList.remove('border-red-500');
            field.classList.add('border-gray-300');
        }
    });

    // Validate CTC range
    const minCTC = parseFloat(minCTCInput.value);
    const maxCTC = parseFloat(maxCTCInput.value);

    if (isNaN(minCTC) || isNaN(maxCTC) || minCTC > maxCTC) {
        ctcError.classList.remove('hidden');
        minCTCInput.classList.add('border-red-500');
        maxCTCInput.classList.add('border-red-500');
        isValid = false;
        if (!firstInvalidField) firstInvalidField = minCTCInput;
    } else {
        ctcError.classList.add('hidden');
        minCTCInput.classList.remove('border-red-500');
        maxCTCInput.classList.remove('border-red-500');
    }

    // Validate Graduating Year range
    const minGradYear = parseInt(minGradYearInput.value);
    const maxGradYear = parseInt(maxGradYearInput.value);

    if (isNaN(minGradYear) || isNaN(maxGradYear) || minGradYear > maxGradYear) {
        gradYearError.classList.remove('hidden');
        minGradYearInput.classList.add('border-red-500');
        maxGradYearInput.classList.add('border-red-500');
        isValid = false;
        if (!firstInvalidField) firstInvalidField = minGradYearInput;
    } else {
        gradYearError.classList.add('hidden');
        minGradYearInput.classList.remove('border-red-500');
        maxGradYearInput.classList.remove('border-red-500');
    }

    // Validate Experience range
    const minExperience = parseFloat(minExperienceInput.value);
    const maxExperience = parseFloat(maxExperienceInput.value);

    if (isNaN(minExperience) || isNaN(maxExperience) || minExperience > maxExperience) {
        experienceError.classList.remove('hidden');
        minExperienceInput.classList.add('border-red-500');
        maxExperienceInput.classList.add('border-red-500');
        isValid = false;
        if (!firstInvalidField) firstInvalidField = minExperienceInput;
    } else {
        experienceError.classList.add('hidden');
        minExperienceInput.classList.remove('border-red-500');
        maxExperienceInput.classList.remove('border-red-500');
    }


    // If there's an invalid field, scroll to it
    if (firstInvalidField) {
        firstInvalidField.focus();
        showMessage('error', 'Validation Error', 'Please fill in all required fields correctly.');
    }

    return isValid;
}

/**
 * Copies the generated job link to the clipboard.
 */
function copyJobLink() {
    const linkInput = document.getElementById('generatedJobLink');
    linkInput.select();
    document.execCommand('copy');
    showMessage('success', 'Copied!', 'Job link copied to clipboard.');
}


/**
 * Handles the form submission, saving data locally and conditionally sending it to an n8n webhook.
 * @param {Event} e - The form submission event.
 * @param {boolean} addAnother - Flag to determine whether to reset the form or redirect.
 */
async function submitForm(e, addAnother) {
    e.preventDefault();

    if (!validateForm()) {
        return; // Stop if validation fails
    }

    const form = document.getElementById('jobForm');
    const formData = new FormData(form);

    const jobId = Date.now(); // Unique ID for the job
    const jobLink = `${window.location.origin}/MVP/job_details.html?id=${jobId}`; // Construct the local link

    // Create a data object from the form fields
    const data = {
        jobTitle: formData.get('jobTitle'),
        jobDescription: formData.get('jobDescription'), // Full description saved locally
        jobLink: jobLink, // The generated link
        targetingIndustry: selectedIndustries,
        category: formData.get('category'),
        functionalArea: formData.get('functionalArea'),
        employmentType: formData.get('employmentType'),
        minExperience: formData.get('minExperience'), // Use new minExperience field
        maxExperience: formData.get('maxExperience'), // Use new maxExperience field
        minCTC: formData.get('minCTC'),
        maxCTC: formData.get('maxCTC'),
        location: formData.get('location'),
        minGradYear: formData.get('minGradYear'),
        maxGradYear: formData.get('maxGradYear'),
        courseType: formData.get('courseType'),
        preferred: formData.get('preferred'),
        id: jobId // Use the generated jobId
    };

    // Save the job data to local storage
    const existing = JSON.parse(localStorage.getItem('jobs') || '[]');
    existing.push(data);
    localStorage.setItem('jobs', JSON.stringify(existing));

    // Display the generated link
    generatedJobLinkInput.value = jobLink;
    jobLinkDisplay.classList.remove('hidden');

    // Check if the user wants to post to LinkedIn via n8n
    const postOnLinkedIn = postOnLinkedInCheckbox.checked;

    if (postOnLinkedIn) {
        showMessage('info', 'Uploading to LinkedIn', '<span class="spinner"></span> Sending job details to LinkedIn via n8n...');
        try {
            // Send the jobLink instead of the full jobDescription to n8n
            const n8nPayload = { ...data, jobDescription: jobLink }; // Send the link in place of description for n8n
            const response = await fetch('https://tanisha0207.app.n8n.cloud/webhook/postToLinkedin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(n8nPayload)
            });

            if (!response.ok) {
                throw new Error(`Failed to submit to n8n: ${response.statusText}`);
            }

            await response.json().catch(() => ({})); // Handle cases where the response is not JSON
            showMessage('success', 'Success!', 'Job posted successfully and link sent to LinkedIn!');

            // Action after successful submission
            if (addAnother) {
                form.reset();
                // Reset selected industries and hide link display
                selectedIndustries = [];
                renderSelectedChips();
                jobLinkDisplay.classList.add('hidden'); // Hide link display
                // Reset CTC fields
                minCTCInput.value = '';
                maxCTCInput.value = '';
                // Reset graduating year inputs to default dynamic values
                const currentYear = new Date().getFullYear();
                minGradYearInput.value = currentYear;
                maxGradYearInput.value = currentYear + 4;
                // Reset experience fields
                minExperienceInput.value = 0;
                maxExperienceInput.value = 5;
                postOnLinkedInCheckbox.checked = false; // Uncheck LinkedIn checkbox
            } else {
                // Do NOT redirect if postOnLinkedIn is true
                // setTimeout(() => {
                //      window.location.href = 'myjobs.html';
                // }, 1500);
            }
        } catch (err) {
            console.error(err);
            showMessage('error', 'Automation Failed', "Job saved locally, but failed to send link to LinkedIn via n8n. Please check your n8n workflow.");
            if (!addAnother) {
                // Do NOT redirect if postOnLinkedIn is true
                // setTimeout(() => {
                //      window.location.href = 'myjobs.html';
                // }, 1500);
            } else {
                form.reset();
                // Reset selected industries and hide link display
                selectedIndustries = [];
                renderSelectedChips();
                jobLinkDisplay.classList.add('hidden'); // Hide link display
                // Reset CTC fields
                minCTCInput.value = '';
                maxCTCInput.value = '';
                // Reset graduating year inputs to default dynamic values
                const currentYear = new Date().getFullYear();
                minGradYearInput.value = currentYear;
                maxGradYearInput.value = currentYear + 4;
                // Reset experience fields
                minExperienceInput.value = 0;
                maxExperienceInput.value = 5;
                postOnLinkedInCheckbox.checked = false; // Uncheck LinkedIn checkbox
            }
        }
    } else {
        // If not posting to LinkedIn, proceed with the UI updates immediately
        showMessage('success', 'Success!', 'Job posted successfully and saved locally!');
        if (addAnother) {
            form.reset();
            // Reset selected industries and hide link display
            selectedIndustries = [];
            renderSelectedChips();
            jobLinkDisplay.classList.add('hidden'); // Hide link display
            // Reset CTC fields
            minCTCInput.value = '';
            maxCTCInput.value = '';
            // Reset graduating year inputs to default dynamic values
            const currentYear = new Date().getFullYear();
            minGradYearInput.value = currentYear;
            maxGradYearInput.value = currentYear + 4;
            // Reset experience fields
            minExperienceInput.value = 0;
            maxExperienceInput.value = 5;
            postOnLinkedInCheckbox.checked = false; // Uncheck LinkedIn checkbox
        } else {
            // Redirect to myjobs.html if not posting to LinkedIn
            setTimeout(() => {
                window.location.href = 'myjobs.html';
            }, 1500);
        }
    }
}

/**
 * Generates a job description using the Gemini API based on the job title.
 */
async function generateJobDescription() {

    console.log({
        jobTitleInput: document.getElementById("jobTitle"),
        category: document.getElementById("category"),
        functionalArea: document.getElementById("functionalArea"),
        employmentType: document.getElementById("employmentType"),
        minExperience: document.getElementById("minExperience"),
        maxExperience: document.getElementById("maxExperience"),
        minCTC: document.getElementById("minCTC"),
        maxCTC: document.getElementById("maxCTC"),
        location: document.getElementById("location"),
        candidateProfile: document.getElementById("candidateProfile"),
        minGradYear: document.getElementById("minGradYear"),
        maxGradYear: document.getElementById("maxGradYear"),
        courseType: document.getElementById("courseType"),
        preferred: document.getElementById("preferred"),
    });
    const jobTitleInput = document.getElementById("jobTitle");
    const jobDescriptionTextarea = document.getElementById("jobDescription");

    const jobTitle = jobTitleInput.value.trim();
    const targetingIndustry = selectedIndustries.join(', ');
    const category = document.getElementById("category").value;
    const functionalArea = document.getElementById("functionalArea").value;
    const employmentType = document.getElementById("employmentType").value;
    const minExperience = document.getElementById("minExperience").value; // Corrected: Use pre-fetched variable
    const maxExperience = document.getElementById("maxExperience").value; // Corrected: Use pre-fetched variable
    const minCTC = document.getElementById("minCTC").value;
    const maxCTC = document.getElementById("maxCTC").value;
    const location = document.getElementById("location").value;
    const candidateProfile = document.getElementById("candidateProfile").value;
    const minGradYear = document.getElementById("minGradYear").value;
    const maxGradYear = document.getElementById("maxGradYear").value;
    const courseType = document.getElementById("courseType").value;
    const preferred = document.getElementById("preferred").value;

    if (!jobTitle) {
        showMessage('info', 'Input Needed', "Please enter a job title first to generate a description.");
        return;
    }

    jobDescriptionTextarea.value = "⏳ Generating job description with AI...";
    generateDescriptionBtn.disabled = true; // Disable button during generation
    generateDescriptionBtn.innerHTML = '<span class="spinner"></span> Generating...'; // Add spinner to button

    const prompt = `
Act as a professional HR content writer. Your task is to generate a concise and structured job description. Do not include any company introduction or general welcome text. The output should be strictly the job description content.

Generate a job description for the role: ${jobTitle}.

The role has the following specifications:
- Targeting Industry: ${targetingIndustry || 'Not specified'}
- Category: ${category || 'Not specified'}
- Functional Area: ${functionalArea || 'Not specified'}
- Employment Type: ${employmentType || 'Not specified'}
- Experience: ${minExperience && maxExperience ? minExperience + ' - ' + maxExperience + ' years' : 'Not specified'}
- Salary (CTC): ${minCTC && maxCTC ? '₹' + minCTC + ' - ₹' + maxCTC : 'Not specified'}
- Location: ${location || 'Not specified'}
- Candidate Profile: ${candidateProfile || 'Not specified'}
- Graduating Year: ${minGradYear && maxGradYear ? minGradYear + ' - ' + maxGradYear : 'Not specified'}
- Course Type: ${courseType || 'Not specified'}
- Preferred Candidates: ${preferred || 'Not specified'}

Include the following sections with clear headings and use bullet points for all items within each section:
1.  Job Overview
2.  Key Responsibilities
3.  Qualifications and Skills
4.  Benefits
5.  Suggested Tags

Keep the tone professional and concise.`;

    // The Canvas environment provides a special API key for Gemini.
    const apiKey = "AIzaSyDzPpT7UnL6uEUzlBoqgF7U-_ctn9v_DS8"; // Leave as-is, Canvas will inject the key at runtime
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
    const payload = { contents: chatHistory };

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        
        const result = await response.json();
        
        if (result.candidates && result.candidates.length > 0 &&
            result.candidates[0].content && result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0) {
            let generatedText = result.candidates[0].content.parts[0].text;
            // Remove all '#' characters and replace with a space
            generatedText = generatedText.replace(/#/g, ' ');
            // Remove any bolding markdown from the generated text
            generatedText = generatedText.replace(/\*\*/g, '');
            jobDescriptionTextarea.value = generatedText;
            showMessage('success', 'AI Generated!', 'Job description generated successfully. Review and post!');
        } else {
            jobDescriptionTextarea.value = "❌ No response from the model. Please try again.";
            showMessage('error', 'AI Generation Failed', 'No response from the model. Please try again.');
        }
    } catch (error) {
        console.error("Error generating job description:", error);
        jobDescriptionTextarea.value = "❌ An error occurred while generating the description. Please check the console for details.";
        showMessage('error', 'AI Generation Failed', 'An error occurred while generating the description. Please check the console for details.');
    } finally {
        generateDescriptionBtn.disabled = false; // Re-enable button
        generateDescriptionBtn.innerHTML = 'Create with AI'; // Reset button text
    }
}


    </script>
</body>
</html>
