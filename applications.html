<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Submitted Applications</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e5e7eb; /* Soft gray background to match the form */
        }
        
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #d1d5db; /* Lighter track */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #6b7280; /* Darker thumb */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563; /* Even darker on hover */
        }
        
        /* Custom modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content {
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded corners */
            max-width: 90%;
            max-height: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: slideIn 0.4s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .modal-close {
            color: #9ca3af;
            position: absolute;
            top: 1.5rem; /* Adjusted for better spacing */
            right: 1.5rem;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close:hover {
            color: #4b5563;
        }
        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Table specific styles for a card-like appearance on rows */
        .table-row-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .table-row-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .scrollable-content {
            max-height: 50vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="p-6 md:p-10 min-h-screen flex flex-col items-center">

    <div class="w-full max-w-7xl">
        <h1 class="text-4xl font-extrabold mb-4 text-center text-gray-900">Application Dashboard</h1>
        <p class="text-center text-gray-600 mb-8">Review and manage all submitted job applications from your local storage.</p>
        
        <div id="applications-container" class="bg-white rounded-2xl shadow-xl overflow-hidden">
        </div>
    </div>
    
    <div id="applicationModal" class="modal">
        <div class="modal-content w-full max-w-4xl h-5/6">
            <span class="modal-close">&times;</span>
            <div class="modal-body p-8">
                <h2 id="modal-applicant-name" class="text-3xl font-bold text-gray-900 mb-2"></h2>
                <p id="modal-position-title" class="text-xl text-indigo-600 mb-6"></p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700">
                    <div>
                        <p class="font-semibold text-gray-900">Contact Information</p>
                        <ul class="list-disc list-inside space-y-1 ml-4 mt-2">
                            <li><strong class="text-gray-600">Email:</strong> <span id="modal-email"></span></li>
                            <li><strong class="text-gray-600">Phone:</strong> <span id="modal-phone"></span></li>
                            <li><strong class="text-gray-600">Availability to Join:</strong> <span id="modal-availability"></span></li>
                        </ul>
                    </div>
                    
                    <div>
                        <p class="font-semibold text-gray-900">Application Details</p>
                        <ul class="list-disc list-inside space-y-1 ml-4 mt-2">
                            <li><strong class="text-gray-600">Applicant Type:</strong> <span id="modal-applicant-type"></span></li>
                            <li><strong class="text-gray-600">Submission Date:</strong> <span id="modal-timestamp"></span></li>
                        </ul>
                    </div>
                </div>

                <!-- Fresher Specific Details -->
                <div id="fresher-details" class="mt-8 hidden">
                    <p class="font-semibold text-gray-900">Fresher Details</p>
                    <ul class="list-disc list-inside space-y-1 ml-4 mt-2 text-gray-700">
                        <li><strong class="text-gray-600">CGPA / Percentage:</strong> <span id="modal-fresher-cgpa"></span></li>
                        <li><strong class="text-gray-600">College / University:</strong> <span id="modal-fresher-college"></span></li>
                        <li><strong class="text-gray-600">Degree & Specialization:</strong> <span id="modal-fresher-degree"></span></li>
                    </ul>
                </div>
                
                <!-- Experienced Specific Details -->
                <div id="experienced-details" class="mt-8 hidden">
                    <p class="font-semibold text-gray-900">Experienced Details</p>
                    <ul class="list-disc list-inside space-y-1 ml-4 mt-2 text-gray-700">
                        <li><strong class="text-gray-600">Current CTC (in LPA):</strong> <span id="modal-experienced-current-ctc"></span></li>
                        <li><strong class="text-gray-600">Expected CTC (in LPA):</strong> <span id="modal-experienced-expected-ctc"></span></li>
                        <li><strong class="text-gray-600">Notice Period:</strong> <span id="modal-experienced-notice-period"></span></li>
                    </ul>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700 mt-8">
                    <div>
                        <p class="font-semibold text-gray-900">Social Profiles</p>
                        <ul class="list-disc list-inside space-y-1 ml-4 mt-2">
                            <li><strong class="text-gray-600">LinkedIn:</strong> <span id="modal-linkedin-profile"></span></li>
                            <li><strong class="text-gray-600">GitHub:</strong> <span id="modal-github-profile"></span></li>
                        </ul>
                    </div>
                    
                    <div>
                        <p class="font-semibold text-gray-900">Skills & Languages</p>
                        <ul class="list-disc list-inside space-y-1 ml-4 mt-2">
                            <li><strong class="text-gray-600">Skills:</strong> <span id="modal-skills"></span></li>
                            <li><strong class="text-gray-600">Language Proficiency:</strong> <span id="modal-language-proficiency"></span></li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-8">
                    <h3 class="text-lg font-semibold text-gray-900">Cover Letter</h3>
                    <div id="modal-cover-letter" class="p-4 bg-gray-100 rounded-xl mt-2 scrollable-content text-gray-800 border border-gray-200"></div>
                </div>

                <div class="mt-8">
                    <h3 class="text-lg font-semibold text-gray-900">Attachments</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-2">
                        <div id="modal-resume-container" class="p-4 bg-gray-100 rounded-xl border border-gray-200 hidden">
                            <strong class="text-gray-700">Resume:</strong>
                            <div class="flex items-center space-x-4 mt-2">
                                <a id="modal-resume-view" href="#" class="text-indigo-600 hover:underline font-medium">View File</a>
                                <a id="modal-resume-download" href="#" download class="text-green-600 hover:underline font-medium">Download File</a>
                            </div>
                        </div>
                        <div id="modal-other-docs-container" class="p-4 bg-gray-100 rounded-xl border border-gray-200 hidden">
                            <strong class="text-gray-700">Other Document:</strong>
                            <div class="flex items-center space-x-4 mt-2">
                                <a id="modal-other-docs-view" href="#" class="text-indigo-600 hover:underline font-medium">View File</a>
                                <a id="modal-other-docs-download" href="#" download class="text-green-600 hover:underline font-medium">Download File</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="fileViewerModal" class="modal">
        <div class="modal-content w-full max-w-5xl h-5/6">
            <span class="modal-close" onclick="closeFileViewerModal()">&times;</span>
            <div class="p-4 text-center border-b border-gray-200">
                <h3 id="viewer-title" class="text-2xl font-semibold text-gray-800"></h3>
            </div>
            <iframe id="fileViewerFrame" class="w-full h-full border-0"></iframe>
        </div>
    </div>

    <script>
        const applicationsContainer = document.getElementById('applications-container');
        const applications = JSON.parse(localStorage.getItem('talentApplications')) || [];
        
        // Modal elements
        const modal = document.getElementById('applicationModal');
        const fileViewerModal = document.getElementById('fileViewerModal');
        const fileViewerFrame = document.getElementById('fileViewerFrame');
        const viewerTitle = document.getElementById('viewer-title');

        const closeBtn = modal.querySelector('.modal-close');
        const closeFileViewerBtn = fileViewerModal.querySelector('.modal-close');

        function openFileViewerModal(dataUrl, fileName) {
            fileViewerFrame.src = dataUrl;
            viewerTitle.textContent = fileName;
            fileViewerModal.style.display = 'flex';
        }

        function closeFileViewerModal() {
            fileViewerModal.style.display = 'none';
            fileViewerFrame.src = '';
        }

        closeBtn.onclick = () => {
            modal.style.display = 'none';
        }
        
        closeFileViewerBtn.onclick = () => {
            closeFileViewerModal();
        }

        window.onclick = (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
            if (event.target === fileViewerModal) {
                closeFileViewerModal();
            }
        }
        
        function renderApplications() {
            if (applications.length === 0) {
                applicationsContainer.innerHTML = `
                    <div class="p-8 text-center text-gray-500 text-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                        </svg>
                        <p class="mt-4">No applications submitted yet.</p>
                    </div>
                `;
                return;
            }

            // Group applications by job title
            const groupedApplications = applications.reduce((acc, app) => {
                const normalizedPosition = (app.appliedPosition || 'Unspecified Job').toLowerCase().trim();
                if (!acc[normalizedPosition]) {
                    acc[normalizedPosition] = {
                        originalTitle: app.appliedPosition || 'Unspecified Job',
                        applications: []
                    };
                }
                acc[normalizedPosition].applications.push(app);
                return acc;
            }, {});

            let appCount = 0;
            let htmlContent = '';

            for (const normalizedPosition in groupedApplications) {
                if (Object.hasOwnProperty.call(groupedApplications, normalizedPosition)) {
                    const group = groupedApplications[normalizedPosition];
                    const jobTitle = group.originalTitle;

                    htmlContent += `
                        <div class="p-6">
                            <h2 class="text-2xl font-semibold text-gray-800 mb-4">${jobTitle} (${group.applications.length} applications)</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    `;

                    group.applications.forEach(app => {
                        appCount++;
                        const timestamp = new Date(app.timestamp).toLocaleDateString();
                        
                        htmlContent += `
                            <div class="p-6 bg-white rounded-xl shadow-md border border-gray-200 hover:border-indigo-400 table-row-card transform hover:-translate-y-1 transition-all duration-200" data-app-index="${appCount - 1}">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0">
                                        <span class="inline-flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 text-indigo-500 font-bold text-xl">
                                            ${app.firstName.charAt(0)}${app.lastName.charAt(0)}
                                        </span>
                                    </div>
                                    <div class="text-left overflow-hidden">
                                        <p class="text-lg font-medium text-gray-900 truncate">${app.firstName} ${app.lastName}</p>
                                        <p class="text-sm text-gray-500 truncate">${app.email}</p>
                                        <p class="text-xs text-gray-400 mt-1">Applied on ${timestamp}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    htmlContent += `
                            </div>
                        </div>
                    `;
                }
            }
            applicationsContainer.innerHTML = htmlContent;

            // Attach click event listeners to the new cards
            document.querySelectorAll('.table-row-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const appIndex = e.currentTarget.dataset.appIndex;
                    showApplicationDetails(applications[appIndex]);
                });
            });
        }

        function showApplicationDetails(app) {
            document.getElementById('modal-applicant-name').textContent = `${app.firstName} ${app.lastName}`;
            document.getElementById('modal-position-title').textContent = app.appliedPosition || 'Unspecified Job';
            document.getElementById('modal-email').textContent = app.email;
            document.getElementById('modal-phone').textContent = app.phoneNumber || 'N/A';
            document.getElementById('modal-availability').textContent = app.fresherDetails?.availability || app.experiencedDetails?.availability || 'N/A';
            document.getElementById('modal-applicant-type').textContent = app.applicantType ? app.applicantType.charAt(0).toUpperCase() + app.applicantType.slice(1) : 'N/A';
            document.getElementById('modal-timestamp').textContent = new Date(app.timestamp).toLocaleString();
            
            // Show/hide dynamic details based on applicant type
            const fresherDetailsSection = document.getElementById('fresher-details');
            const experiencedDetailsSection = document.getElementById('experienced-details');
            
            fresherDetailsSection.classList.add('hidden');
            experiencedDetailsSection.classList.add('hidden');
            
            if (app.applicantType === 'fresher' && app.fresherDetails) {
                fresherDetailsSection.classList.remove('hidden');
                document.getElementById('modal-fresher-cgpa').textContent = app.fresherDetails.cgpa || 'N/A';
                document.getElementById('modal-fresher-college').textContent = app.fresherDetails.college || 'N/A';
                document.getElementById('modal-fresher-degree').textContent = app.fresherDetails.degree || 'N/A';
            } else if (app.applicantType === 'experienced' && app.experiencedDetails) {
                experiencedDetailsSection.classList.remove('hidden');
                document.getElementById('modal-experienced-current-ctc').textContent = app.experiencedDetails.currentCTC ? `${app.experiencedDetails.currentCTC} LPA` : 'N/A';
                document.getElementById('modal-experienced-expected-ctc').textContent = app.experiencedDetails.expectedCTC ? `${app.experiencedDetails.expectedCTC} LPA` : 'N/A';
                document.getElementById('modal-experienced-notice-period').textContent = app.experiencedDetails.noticePeriod ? `${app.experiencedDetails.noticePeriod} days` : 'N/A';
            }

            const linkedinProfileElement = document.getElementById('modal-linkedin-profile');
            if (app.linkedinProfile) {
                linkedinProfileElement.innerHTML = `<a href="${app.linkedinProfile}" target="_blank" class="text-indigo-600 hover:underline font-medium">${app.linkedinProfile.split('/').pop() || 'View Profile'}</a>`;
            } else {
                linkedinProfileElement.textContent = 'N/A';
            }

            const githubProfileElement = document.getElementById('modal-github-profile');
            if (app.githubProfile) {
                githubProfileElement.innerHTML = `<a href="${app.githubProfile}" target="_blank" class="text-indigo-600 hover:underline font-medium">${app.githubProfile.split('/').pop() || 'View Profile'}</a>`;
            } else {
                githubProfileElement.textContent = 'N/A';
            }

            document.getElementById('modal-skills').textContent = app.skills || 'N/A';
            document.getElementById('modal-language-proficiency').textContent = app.languageProficiency || 'N/A';

            const coverLetterContent = document.getElementById('modal-cover-letter');
            coverLetterContent.innerHTML = app.coverLetter ? `<p class="whitespace-pre-line">${app.coverLetter}</p>` : 'N/A';

            // Handle Resume links
            const resumeContainer = document.getElementById('modal-resume-container');
            const resumeViewLink = document.getElementById('modal-resume-view');
            const resumeDownloadLink = document.getElementById('modal-resume-download');
            if (app.resumeData) {
                resumeContainer.classList.remove('hidden');
                resumeViewLink.onclick = (e) => {
                    e.preventDefault();
                    openFileViewerModal(app.resumeData, app.resumeName);
                }
                resumeDownloadLink.href = app.resumeData;
                resumeDownloadLink.download = app.resumeName;
            } else {
                resumeContainer.classList.add('hidden');
            }

            // Handle Other Documents links
            const otherDocsContainer = document.getElementById('modal-other-docs-container');
            const otherDocsViewLink = document.getElementById('modal-other-docs-view');
            const otherDocsDownloadLink = document.getElementById('modal-other-docs-download');
            if (app.otherDocsData) {
                otherDocsContainer.classList.remove('hidden');
                otherDocsViewLink.onclick = (e) => {
                    e.preventDefault();
                    openFileViewerModal(app.otherDocsData, app.otherDocsName);
                }
                otherDocsDownloadLink.href = app.otherDocsData;
                otherDocsDownloadLink.download = app.otherDocsName;
            } else {
                otherDocsContainer.classList.add('hidden');
            }

            modal.style.display = 'flex';
        }

        // Initial render
        renderApplications();
    </script>
</body>
</html>
