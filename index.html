<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google & Email Sign-up</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <!-- Authentication UI Container -->
    <div id="auth-container" class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md text-center">
        <h1 class="text-3xl font-bold mb-4 text-gray-900">Get Started</h1>
        <p class="text-gray-600 mb-8">Sign up or sign in to continue.</p>

        <!-- Dynamic UI content will be rendered here -->
        <div id="ui-content" class="min-h-[120px]">
            <!-- Sign In Form (initially visible) -->
            <div id="signin-form">
                <!-- Google Sign-in Button -->
                <button id="google-signin-button" class="flex items-center justify-center gap-2 w-full bg-white text-gray-700 border-2 border-gray-300 py-3 px-4 rounded-lg font-semibold hover:bg-gray-50 transition-colors duration-200 shadow-sm mb-4">
                    <svg class="w-5 h-5" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M44.5 24c0-1.5-.13-2.93-.36-4.32H24v8.16h11.88c-.52 2.53-2.09 4.67-4.48 6.07v5.27h6.79c3.97-3.66 6.27-9.08 6.27-15.18z" fill="#4285F4"/>
                        <path d="M24 45.996c6.48 0 11.97-2.16 15.96-5.84l-6.79-5.27c-1.84 1.25-4.22 2.05-7.17 2.05-5.5 0-10.15-3.72-11.83-8.72H5.32v5.27c3.98 7.9 12.16 13.51 18.68 13.51z" fill="#34A853"/>
                        <path d="M12.17 29.836c-.4-.95-.62-1.99-.62-3.07s.22-2.12.62-3.07V18.42H5.34v5.27c.86 1.7 1.34 3.56 1.34 5.49s-.48 3.79-1.34 5.49h6.83z" fill="#FBBC05"/>
                        <path d="M24 10.004c3.55 0 6.69 1.22 9.19 3.56l5.96-5.74C35.97 3.32 30.48 0 24 0c-6.52 0-14.7 5.61-18.68 13.51l6.83 5.27c1.68-5 6.33-8.72 11.83-8.72z" fill="#EA4335"/>
                    </svg>
                    Sign in with Google
                </button>

                <div class="relative flex items-center justify-center mb-6">
                    <div class="w-full h-px bg-gray-300"></div>
                    <div class="absolute bg-white px-4 text-gray-500 text-sm">or</div>
                </div>

                <form id="signin-form-fields" class="space-y-4">
                    <div>
                        <input type="email" id="signin-email" placeholder="Email address" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                    </div>
                    <div>
                        <input type="password" id="signin-password" placeholder="Password" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200">Sign In</button>
                </form>

                <div class="mt-4 text-sm text-gray-600">
                    Don't have an account? <a href="register.html" id="show-signup-link" class="text-blue-600 hover:underline font-medium">Register here.</a>
                </div>
            </div>

            <!-- Sign Up Form (initially hidden) -->
            <!-- This section is commented out as the registration is handled on a separate page (recruiter-page-corrected.html) -->
            <!-- <div id="signup-form" class="hidden">
                <form id="signup-form-fields" class="space-y-4 mb-4">
                    <div>
                        <input type="email" id="signup-email" placeholder="Email address" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                    </div>
                    <div>
                        <input type="password" id="signup-password" placeholder="Password" required class="w-full p-3 rounded-lg border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200">Sign Up</button>
                </form>

                <div class="relative flex items-center justify-center mb-6">
                    <div class="w-full h-px bg-gray-300"></div>
                    <div class="absolute bg-white px-4 text-gray-500 text-sm">or</div>
                </div> -->

                <!-- Google Sign-in Button (repeated for convenience) -->
                <!-- <button id="google-signup-button" class="flex items-center justify-center gap-2 w-full bg-white text-gray-700 border-2 border-gray-300 py-3 px-4 rounded-lg font-semibold hover:bg-gray-50 transition-colors duration-200 shadow-sm"> -->
                    <!-- <svg class="w-5 h-5" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M44.5 24c0-1.5-.13-2.93-.36-4.32H24v8.16h11.88c-.52 2.53-2.09 4.67-4.48 6.07v5.27h6.79c3.97-3.66 6.27-9.08 6.27-15.18z" fill="#4285F4"/>
                        <path d="M24 45.996c6.48 0 11.97-2.16 15.96-5.84l-6.79-5.27c-1.84 1.25-4.22 2.05-7.17 2.05-5.5 0-10.15-3.72-11.83-8.72H5.32v5.27c3.98 7.9 12.16 13.51 18.68 13.51z" fill="#34A853"/>
                        <path d="M12.17 29.836c-.4-.95-.62-1.99-.62-3.07s.22-2.12.62-3.07V18.42H5.34v5.27c.86 1.7 1.34 3.56 1.34 5.49s-.48 3.79-1.34 5.49h6.83z" fill="#FBBC05"/>
                        <path d="M24 10.004c3.55 0 6.69 1.22 9.19 3.56l5.96-5.74C35.97 3.32 30.48 0 24 0c-6.52 0-14.7 5.61-18.68 13.51l6.83 5.27c1.68-5 6.33-8.72 11.83-8.72z" fill="#EA4335"/>
                    </svg>
                    Sign up with Google
                </button>

                <div class="mt-4 text-sm text-gray-600">
                    Already have an account? <a href="#" id="show-signin-link" class="text-blue-600 hover:underline font-medium">Sign in here.</a>
                </div>
            </div> -->
            
            <!-- Message box for user feedback -->
            <div id="message-box" class="mt-4 hidden p-4 text-sm rounded-lg"></div>
        </div>
    </div>

    <!-- Firebase SDK Imports (Modular v9+) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            onAuthStateChanged, 
            // createUserWithEmailAndPassword, // Not used for local storage signup
            // signInWithEmailAndPassword, // Not used for local storage signin
            signInWithCustomToken,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

        // === Canvas-specific global variables ===
        const firebaseConfig = {
            apiKey: "AIzaSyAA4mmcswhSZn-_jGY8zOLa0vhzwt4CJ84",
            authDomain: "signup-d3fc5.firebaseapp.com",
            projectId: "signup-d3fc5",
            storageBucket: "signup-d3fc5.firebasestorage.app",
            messagingSenderId: "322268900754",
            appId: "1:322268900754:web:27853b1e8f7d4194dd654b",
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // UI element references
        const signInForm = document.getElementById('signin-form');
        // const signUpForm = document.getElementById('signup-form'); // Commented out as signup is external
        const signInEmailInput = document.getElementById('signin-email');
        const signInPasswordInput = document.getElementById('signin-password');
        // const signUpEmailInput = document.getElementById('signup-email'); // Commented out as signup is external
        // const signUpPasswordInput = document.getElementById('signup-password'); // Commented out as signup is external
        const messageBox = document.getElementById('message-box');

        // Function to display a message to the user
        const showMessage = (message, type = 'info') => {
            messageBox.textContent = message;
            messageBox.className = `mt-4 p-4 text-sm rounded-lg ${
                type === 'error' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'
            }`;
            messageBox.classList.remove('hidden');
            setTimeout(() => messageBox.classList.add('hidden'), 5000); // Hide after 5 seconds
        };

        // Function to switch between sign-in and sign-up forms (simplified as signup is external)
        const toggleAuthMode = (mode) => {
            // Since signup is handled by recruiter-page-corrected.html,
            // this function mainly ensures the sign-in form is visible.
            if (mode === 'signin') {
                signInForm.classList.remove('hidden');
                // if (signUpForm) signUpForm.classList.add('hidden'); // If signup form was in this HTML
            }
            messageBox.classList.add('hidden'); // Clear any messages when switching
        };

        // Handle sign-in with Google Pop-up
        const handleGoogleSignIn = async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Google Sign-in Error:", error);
                showMessage(`Google Sign-in failed: ${error.message}`, 'error');
            }
        };

        // Handle sign-in with Email and Password (using local storage)
        const handleEmailSignIn = async (e) => {
            e.preventDefault();
            const email = signInEmailInput.value;
            const password = signInPasswordInput.value;

            const storedData = localStorage.getItem(email);

            if (storedData) {
                const userData = JSON.parse(storedData);
                if (userData.password === password) {
                    localStorage.setItem('loggedInUser', email); // Store logged-in user email
                    showMessage("Logged in successfully!", 'info');
                    // Redirect after a short delay to allow message to be seen
                    setTimeout(() => {
                        window.location.href = './index.html';
                    }, 1000);
                } else {
                    showMessage("Invalid email or password.", 'error');
                }
            } else {
                showMessage("Invalid email or password.", 'error');
            }
        };

        // Handle user creation with Email and Password (No longer used in this file as registration is external)
        // const handleEmailSignUp = async (e) => {
        //     e.preventDefault();
        //     const email = signUpEmailInput.value;
        //     const password = signUpPasswordInput.value;
        //     try {
        //         await createUserWithEmailAndPassword(auth, email, password);
        //     } catch (error) {
        //         console.error("Email Sign-up Error:", error);
        //         showMessage(`Sign-up failed: ${error.message}`, 'error');
        //     }
        // };

        // Listen for Firebase authentication state changes and redirect (for Google Sign-in)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in via Firebase (e.g., Google Sign-in)
                const displayName = user.displayName || user.email;
                showMessage(`Successfully signed in as ${displayName}. Redirecting...`);
                setTimeout(() => {
                    window.location.href = './index.html'; 
                }, 1000); 
            } else {
                // User is signed out, ensure the sign-in form is visible
                toggleAuthMode('signin');
            }
        });

        // Initialize Canvas auth token on page load
        const initialAuthToken = ''; // This will be provided by Canvas runtime
        if (initialAuthToken) {
            signInWithCustomToken(auth, initialAuthToken).catch(error => {
                console.error("Canvas Auth Error:", error);
                showMessage("An error occurred with Canvas authentication. Please try again.", 'error');
            });
        }
        
        // Add event listener to automatically sign out on tab close
        window.addEventListener('beforeunload', async (e) => {
            if (auth.currentUser) {
                await signOut(auth);
            }
        });

        // Event listeners for UI interactions
        document.getElementById('google-signin-button').addEventListener('click', handleGoogleSignIn);
        // document.getElementById('google-signup-button').addEventListener('click', handleGoogleSignIn); // Not used as signup is external
        
        // Link to the external registration page
        document.getElementById('show-signup-link').addEventListener('click', (e) => {
            // Prevent default navigation to allow the browser to handle the href
            // This link now directly points to recruiter-page-corrected.html
        });
        
        // This link is not present in the current HTML as signup-form is commented out
        // document.getElementById('show-signin-link').addEventListener('click', (e) => {
        //     e.preventDefault();
        //     toggleAuthMode('signin');
        // });

        document.getElementById('signin-form-fields').addEventListener('submit', handleEmailSignIn);
     // document.getElementById('signup-form-fields').addEventListener('submit', handleEmailSignUp); // Not used as signup is external
    
    // Example of how you would save the username on a login page
function onSuccessfulLogin(userName) {
    localStorage.setItem('username', userName);
    // Then redirect to the dashboard page
    window.location.href = 'dashboard.html';
}
    </script>
</body>
</html>
